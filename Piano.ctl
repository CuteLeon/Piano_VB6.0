VERSION 5.00
Begin VB.UserControl Piano 
   Appearance      =   0  'Flat
   BackColor       =   &H80000005&
   BorderStyle     =   1  'Fixed Single
   ClientHeight    =   2730
   ClientLeft      =   0
   ClientTop       =   0
   ClientWidth     =   17205
   ScaleHeight     =   182
   ScaleMode       =   3  'Pixel
   ScaleWidth      =   1147
   Begin VB.PictureBox Picture1 
      Appearance      =   0  'Flat
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H80000005&
      BorderStyle     =   0  'None
      ForeColor       =   &H80000008&
      Height          =   2655
      Index           =   0
      Left            =   0
      Picture         =   "Piano.ctx":0000
      ScaleHeight     =   177
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   1144
      TabIndex        =   0
      TabStop         =   0   'False
      Top             =   0
      Width           =   17160
   End
   Begin VB.PictureBox KW 
      Appearance      =   0  'Flat
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H80000005&
      BorderStyle     =   0  'None
      ForeColor       =   &H80000008&
      Height          =   2655
      Index           =   8
      Left            =   0
      Picture         =   "Piano.ctx":97A2
      ScaleHeight     =   177
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   23
      TabIndex        =   11
      TabStop         =   0   'False
      Top             =   0
      Visible         =   0   'False
      Width           =   345
   End
   Begin VB.PictureBox KW 
      Appearance      =   0  'Flat
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H80000005&
      BorderStyle     =   0  'None
      ForeColor       =   &H80000008&
      Height          =   1800
      Index           =   7
      Left            =   2880
      Picture         =   "Piano.ctx":9D0F
      ScaleHeight     =   120
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   17
      TabIndex        =   10
      TabStop         =   0   'False
      Top             =   0
      Visible         =   0   'False
      Width           =   255
   End
   Begin VB.PictureBox KW 
      Appearance      =   0  'Flat
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H80000005&
      BorderStyle     =   0  'None
      ForeColor       =   &H80000008&
      Height          =   2655
      Index           =   6
      Left            =   1080
      Picture         =   "Piano.ctx":A189
      ScaleHeight     =   177
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   23
      TabIndex        =   9
      TabStop         =   0   'False
      Top             =   0
      Visible         =   0   'False
      Width           =   345
   End
   Begin VB.PictureBox KW 
      Appearance      =   0  'Flat
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H80000005&
      BorderStyle     =   0  'None
      ForeColor       =   &H80000008&
      Height          =   2655
      Index           =   5
      Left            =   1800
      Picture         =   "Piano.ctx":A616
      ScaleHeight     =   177
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   23
      TabIndex        =   8
      TabStop         =   0   'False
      Top             =   0
      Visible         =   0   'False
      Width           =   345
   End
   Begin VB.PictureBox KW 
      Appearance      =   0  'Flat
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H80000005&
      BorderStyle     =   0  'None
      ForeColor       =   &H80000008&
      Height          =   2655
      Index           =   4
      Left            =   2160
      Picture         =   "Piano.ctx":AB55
      ScaleHeight     =   177
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   23
      TabIndex        =   7
      TabStop         =   0   'False
      Top             =   0
      Visible         =   0   'False
      Width           =   345
   End
   Begin VB.PictureBox KW 
      Appearance      =   0  'Flat
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H80000005&
      BorderStyle     =   0  'None
      ForeColor       =   &H80000008&
      Height          =   2655
      Index           =   2
      Left            =   2520
      Picture         =   "Piano.ctx":B0B4
      ScaleHeight     =   177
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   23
      TabIndex        =   5
      TabStop         =   0   'False
      Top             =   0
      Visible         =   0   'False
      Width           =   345
   End
   Begin VB.PictureBox KW 
      Appearance      =   0  'Flat
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H80000005&
      BorderStyle     =   0  'None
      ForeColor       =   &H80000008&
      Height          =   2655
      Index           =   1
      Left            =   1440
      Picture         =   "Piano.ctx":B5F3
      ScaleHeight     =   177
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   23
      TabIndex        =   4
      TabStop         =   0   'False
      Top             =   0
      Visible         =   0   'False
      Width           =   345
   End
   Begin VB.PictureBox KW 
      Appearance      =   0  'Flat
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H80000005&
      BorderStyle     =   0  'None
      ForeColor       =   &H80000008&
      Height          =   2655
      Index           =   0
      Left            =   720
      Picture         =   "Piano.ctx":BB52
      ScaleHeight     =   177
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   23
      TabIndex        =   3
      TabStop         =   0   'False
      Top             =   0
      Visible         =   0   'False
      Width           =   345
   End
   Begin VB.PictureBox Buffer 
      Appearance      =   0  'Flat
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H80000005&
      BorderStyle     =   0  'None
      ForeColor       =   &H80000008&
      Height          =   1095
      Left            =   6480
      ScaleHeight     =   73
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   145
      TabIndex        =   2
      TabStop         =   0   'False
      Top             =   2040
      Visible         =   0   'False
      Width           =   2175
   End
   Begin VB.PictureBox KW 
      Appearance      =   0  'Flat
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H80000005&
      BorderStyle     =   0  'None
      ForeColor       =   &H80000008&
      Height          =   2655
      Index           =   3
      Left            =   360
      Picture         =   "Piano.ctx":BFDF
      ScaleHeight     =   177
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   23
      TabIndex        =   6
      TabStop         =   0   'False
      Top             =   0
      Visible         =   0   'False
      Width           =   345
   End
   Begin VB.PictureBox Picture1 
      Appearance      =   0  'Flat
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BackColor       =   &H80000005&
      BorderStyle     =   0  'None
      ForeColor       =   &H80000008&
      Height          =   2415
      Index           =   1
      Left            =   4800
      ScaleHeight     =   161
      ScaleMode       =   3  'Pixel
      ScaleWidth      =   1162
      TabIndex        =   1
      TabStop         =   0   'False
      Top             =   240
      Visible         =   0   'False
      Width           =   17430
   End
End
Attribute VB_Name = "Piano"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = True
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'×÷Õß: zxrobin   2009.7.5
'Download by http://www.codefans.net
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
Option Explicit

Private Declare Function BitBlt _
                Lib "gdi32" (ByVal hDestDC As Long, _
                             ByVal x As Long, _
                             ByVal y As Long, _
                             ByVal nWidth As Long, _
                             ByVal nHeight As Long, _
                             ByVal hSrcDC As Long, _
                             ByVal xSrc As Long, _
                             ByVal ySrc As Long, _
                             ByVal dwRop As Long) As Long

Private Declare Function GetCursorPos Lib "user32" (lpPoint As POINTAPI) As Long

Private Declare Function ScreenToClient _
                Lib "user32" (ByVal hwnd As Long, _
                              lpPoint As POINTAPI) As Long
                              
Private Declare Function midiOutClose Lib "winmm.dll" (ByVal hMidiOut As Long) As Long

Private Declare Function midiOutOpen _
                Lib "winmm.dll" (lphMidiOut As Long, _
                                 ByVal uDeviceID As Long, _
                                 ByVal dwCallback As Long, _
                                 ByVal dwInstance As Long, _
                                 ByVal dwFlags As Long) As Long

Private Declare Function midiOutShortMsg _
                Lib "winmm.dll" (ByVal hMidiOut As Long, _
                                 ByVal dwMsg As Long) As Long

Public Enum MidiMu

    AcousticGrandPiano´ó¸ÖÇÙÉùÑ§¸ÖÇÙ
    BrightAcousticPianoÃ÷ÁÁµÄ¸ÖÇÙ
    ElectricGrandPianoµç¸ÖÇÙ
    Honky_tonkPiano¾Æ°É¸ÖÇÙ
    RhodesPianoÈáºÍµÄµç¸ÖÇÙ
    ChorusedPiano¼ÓºÏ³ªÐ§¹ûµÄµç¸ÖÇÙ
    HarpsichordÓð¹Ü¼üÇÙ²¦ÏÒ¹Å¸ÖÇÙ
    Clavichord¿ÆÀ­Î¬¿ÆÌØÇÙ»÷ÏÒ¹Å¸ÖÇÙ
    Celesta¸ÖÆ¬ÇÙ
    GlockenspielÖÓÇÙ
    Musicbox°ËÒôºÐ
    Vibraphone²üÒôÇÙ
    MarimbaÂíÁÖ°Í
    XylophoneÄ¾ÇÙ
    TubularBells¹ÜÖÓ
    Dulcimer´óÑïÇÙ
    HammondOrgan»÷¸Ë·çÇÙ
    PercussiveOrgan´ò»÷Ê½·çÇÙ
    RockOrganÒ¡¹ö·çÇÙ
    ChurchOrgan½ÌÌÃ·çÇÙ
    ReedOrgan»É¹Ü·çÇÙ
    AccordianÊÖ·çÇÙ
    Harmonica¿ÚÇÙ
    TangoAccordianÌ½¸êÊÖ·çÇÙ
    AcousticGuitar_nylon_ÄáÁúÏÒ¼ªËû
    AcousticGuitar_steel_¸ÖÏÒ¼ªËû
    ElectricGuitar_jazz_¾ôÊ¿µç¼ªËû
    ElectricGuitar_clean_ÇåÒôµç¼ªËû
    ElectricGuitar_muted_ÃÆÒôµç¼ªËû
    OverdrivenGuitar¼ÓÇý¶¯Ð§¹ûµÄµç¼ªËû
    DistortionGuitar¼ÓÊ§ÕæÐ§¹ûµÄµç¼ªËû
    GuitarHarmonics¼ªËûºÍÒô
    AcousticBass´ó±´Ë¾ÉùÑ§±´Ë¾
    ElectricBass_finger_µç±´Ë¾Ö¸µ¯
    ElectricBass_pick_µç±´Ë¾²¦Æ¬
    FretlessBassÎÞÆ·±´Ë¾
    SlapBass1ÕÆ»÷Bass1
    SlapBass2ÕÆ»÷Bass2
    SynthBass1µç×ÓºÏ³ÉBass1
    SynthBass2µç×ÓºÏ³ÉBass2
    ViolinÐ¡ÌáÇÙ
    ViolaÖÐÌáÇÙ
    Cello´óÌáÇÙ
    ContrabassµÍÒô´óÌáÇÙ
    TremoloStringsÏÒÀÖÈº²üÒôÒôÉ«
    PizzicatoStringsÏÒÀÖÈº²¦ÏÒÒôÉ«
    OrchestralHarpÊúÇÙ
    Timpani¶¨Òô¹Ä
    StringEnsemble1ÏÒÀÖºÏ×àÒôÉ«1
    StringEnsemble2ÏÒÀÖºÏ×àÒôÉ«2
    SynthStrings1ºÏ³ÉÏÒÀÖºÏ×àÒôÉ«1
    SynthStrings2ºÏ³ÉÏÒÀÖºÏ×àÒôÉ«2
    ChoirAahsÈËÉùºÏ³ª_°¡
    VoiceOohsÈËÉù_à½
    SynthVoiceºÏ³ÉÈËÉù
    OrchestraHit¹ÜÏÒÀÖÇÃ»÷Æë×à
    TrumpetÐ¡ºÅ
    Trombone³¤ºÅ
    Tuba´óºÅ
    MutedTrumpet¼ÓÈõÒôÆ÷Ð¡ºÅ
    FrenchHorn·¨¹úºÅÔ²ºÅ
    BrassSectionÍ­¹Ü×éÍ­¹ÜÀÖÆ÷ºÏ×àÒôÉ«
    SynthBrass1ºÏ³ÉÍ­¹ÜÒôÉ«1
    SynthBrass2ºÏ³ÉÍ­¹ÜÒôÉ«2
    SopranoSax¸ßÒôÈø¿ËË¹·ç
    AltoSax´ÎÖÐÒôÈø¿ËË¹·ç
    TenorSaxÖÐÒôÈø¿ËË¹·ç
    BaritoneSaxµÍÒôÈø¿ËË¹·ç
    OboeË«»É¹Ü
    EnglishHornÓ¢¹ú¹Ü
    Bassoon°ÍËÉ´ó¹Ü
    Clarinetµ¥»É¹ÜºÚ¹Ü
    Piccolo¶ÌµÑ
    Flute³¤µÑ
    RecorderÊúµÑ
    PanFluteÅÅóï
    BottleBlow
    ShakuhachiÈÕ±¾³ß°Ë
    Whistle¿ÚÉÚÉù
    Ocarina°Â¿¨À×ÄÇ
    Lead_square_ºÏ³ÉÖ÷Òô1·½²¨
    Lead_sawtooth_ºÏ³ÉÖ÷Òô2¾â³Ý²¨
    Lead_caliopelead_ºÏ³ÉÖ÷Òô
    Lead_chifflead_ºÏ³ÉÖ÷Òô
    Lead_charang_ºÏ³ÉÖ÷Òô
    Lead_voice_ºÏ³ÉÖ÷Òô6ÈËÉù
    Lead_fifths_ºÏ³ÉÖ÷Òô7Æ½ÐÐÎå¶È
    Lead_bass_lead_ºÏ³ÉÖ÷Òô8±´Ë¾¼ÓÖ÷Òô
    Pad_newage_ºÏ³ÉÒôÉ«1ÐÂÊÀ¼Í
    Pad_warm_ºÏ³ÉÒôÉ«ÎÂÅ¯
    Pad_polysynth_ºÏ³ÉÒôÉ«
    Pad_choir_ºÏ³ÉÒôÉ«ºÏ³ª
    Pad_bowed_ºÏ³ÉÒôÉ«
    Pad_metallic_ºÏ³ÉÒôÉ«½ðÊôÉù
    Pad_halo_ºÏ³ÉÒôÉ«¹â»·
    Pad_sweep_ºÏ³ÉÒôÉ«
    FX_rain_ºÏ³ÉÐ§¹ûÓêÉù
    FX_soundtrack_ºÏ³ÉÐ§¹ûÒô¹ì
    FX_crystal_ºÏ³ÉÐ§¹ûË®¾§
    FX_atmosphere_ºÏ³ÉÐ§¹û´óÆø
    FX_brightness_ºÏ³ÉÐ§¹ûÃ÷ÁÁ
    FX_goblins_ºÏ³ÉÐ§¹û¹í¹Ö
    FX_echoes_ºÏ³ÉÐ§¹û»ØÉù
    FX_sci_fi_ºÏ³ÉÐ§¹û¿Æ»Ã
    SitarÎ÷Ëþ¶ûÓ¡¶È
    Banjo°à×¿ÇÙÃÀÖÞ
    ShamisenÈýÃÁÏßÈÕ±¾
    KotoÊ®ÈýÏÒóÝÈÕ±¾
    Kalimba¿¨ÁÖ°Í
    Bagpipe·çµÑ
    FiddleÃñ×åÌáÇÙ
    ShanaiÉ½ÄÎ
    TinkleBell¶£µ±Áå
    Agogo
    SteelDrums¸Ö¹Ä
    WoodblockÄ¾Óã
    TaikoDrumÌ«¹Ä
    MelodicTomÍ¨Í¨¹Ä
    SynthDrumºÏ³É¹Ä
    ReverseCymbalÍ­îà
    GuitarFretNoise¼ªËû»»°ÑÔÓÒô
    BreathNoiseºôÎüÉù
    Seashoreº£ÀËÉù
    BirdTweetÄñÃù
    TelephoneRingµç»°Áå
    HelicopterÖ±Éý»ú
    Applause¹ÄÕÆÉù
    GunshotÇ¹Éù

End Enum

Private Type POINTAPI

    x As Long
    y As Long

End Type

Private Const SRCINVERT = &H660046       ' (DWORD) dest = source XOR dest

Private Const SRCCOPY = &HCC0020 ' (DWORD) dest = source

Private hMidiIn As Long, hMidiOut As Long

Dim Sel(128)    As Boolean, tempNote As Byte

Dim AP          As Boolean, YinSe As MidiMu

Public Event Click(ByVal Note As Byte)

Public Event Move(ByVal Note As Byte, _
                  Button As Integer, _
                  Shift As Integer, _
                  x As Single, _
                  y As Single)

Public Event Down(ByVal Note As Byte, _
                  Button As Integer, _
                  Shift As Integer, _
                  x As Single, _
                  y As Single)

Public Event Up(ByVal Note As Byte, _
                Button As Integer, _
                Shift As Integer, _
                x As Single, _
                y As Single)

Public Event KeyDown(KeyCode As Integer, Shift As Integer)

Public Event KeyUp(KeyCode As Integer, Shift As Integer)

Public Function OpenDevices(Optional ByVal ID As Long = 0) As Long

    If hMidiOut <> 0 Then Exit Function
    If 0 = midiOutOpen(hMidiOut, ID, 0, 0, 0) Then
        OpenDevices = hMidiOut
        ChangeYinSe YinSe
    Else
        OpenDevices = 0
    End If

End Function

Public Function CloseDevices() As Long

    If hMidiOut <> 0 Then midiOutClose hMidiOut: hMidiOut = 0
End Function

Public Sub PlayNote(ByVal Note As Byte, _
                    Optional ByVal s As Byte = 112, _
                    Optional ByVal n As Byte = 0)

    If hMidiOut = 0 Then Exit Sub

    Dim MidiMsg As Long

    MidiMsg = &H90& + Note * &H100& + s * &H10000 + n
    midiOutShortMsg hMidiOut, MidiMsg
End Sub

Public Sub PlayMsg(ByVal MidiMsg As Long)

    If hMidiOut = 0 Then Exit Sub
    midiOutShortMsg hMidiOut, MidiMsg
End Sub

Public Sub ChangeYinSe(Optional ByVal Ys As MidiMu = 0, Optional ByVal n As Byte = 0)

    PlayMsg &HC0& + n + Ys * &H100&
      
End Sub

Public Sub selc(ByVal Index As Byte)
    Sel(Index) = True

    If AP Then PlayNote Index
    DrawKeybd
End Sub

Public Sub unSelc(ByVal Index As Byte)
    Sel(Index) = False

    If AP Then PlayNote Index, 0
    DrawKeybd
End Sub

Public Function isSelc(ByVal Index As Byte)
    isSelc = Sel(Index)
End Function

Private Sub Picture1_Click(Index As Integer)

    Dim Po As POINTAPI

    GetCursorPos Po
    ScreenToClient Picture1(0).hwnd, Po
    RaiseEvent Click(GetNote(Po.x, Po.y))
End Sub

Private Sub Picture1_KeyDown(Index As Integer, KeyCode As Integer, Shift As Integer)
    RaiseEvent KeyDown(KeyCode, Shift)
End Sub

Private Sub Picture1_KeyUp(Index As Integer, KeyCode As Integer, Shift As Integer)
    RaiseEvent KeyUp(KeyCode, Shift)
End Sub

Private Sub Picture1_MouseDown(Index As Integer, _
                               Button As Integer, _
                               Shift As Integer, _
                               x As Single, _
                               y As Single)

    Dim Po As POINTAPI, hei As Boolean

    GetCursorPos Po
    ScreenToClient Picture1(0).hwnd, Po
    tempNote = GetNote(Po.x, Po.y)
    selc tempNote
    RaiseEvent Down(tempNote, Button, Shift, x, y)
End Sub

Private Sub Picture1_MouseMove(Index As Integer, _
                               Button As Integer, _
                               Shift As Integer, _
                               x As Single, _
                               y As Single)

    Dim Po As POINTAPI, hei As Boolean

    GetCursorPos Po
    ScreenToClient Picture1(0).hwnd, Po

    If Button <> 0 Then
        If tempNote <> GetNote(Po.x, Po.y) Then
            unSelc tempNote
            tempNote = GetNote(Po.x, Po.y)
            selc tempNote
        End If

    Else
        tempNote = GetNote(Po.x, Po.y)
    End If

    RaiseEvent Move(tempNote, Button, Shift, x, y)
End Sub

Private Sub Picture1_MouseUp(Index As Integer, _
                             Button As Integer, _
                             Shift As Integer, _
                             x As Single, _
                             y As Single)

    Dim Po As POINTAPI, hei As Boolean

    GetCursorPos Po
    ScreenToClient Picture1(0).hwnd, Po
    unSelc tempNote
    RaiseEvent Up(tempNote, Button, Shift, x, y)
End Sub

Private Sub UserControl_Initialize()
   
    Dim i As Long

    Picture1(0).Top = 0
    Picture1(0).Left = 0
    UserControl.Width = Picture1(0).Width * 15 + 15
    UserControl.Height = Picture1(0).Height * 15 + 15
    Buffer.Width = Picture1(0).Width
    Buffer.Height = Picture1(0).Height
    Picture1(1).Height = Picture1(0).Height
    Picture1(1).Width = Picture1(0).Width
    Picture1(1).Picture = Picture1(0).Picture

    For i = 0 To 128
        Sel(i) = False
    Next

End Sub

Private Sub UserControl_ReadProperties(PropBag As PropertyBag)
    AP = PropBag.ReadProperty("AutoPlay", False)
    YinSe = PropBag.ReadProperty("mYinSe", 0)
End Sub

Private Sub UserControl_Resize()
    UserControl.Width = Picture1(0).Width * 15 + 15
    UserControl.Height = Picture1(0).Height * 15 + 15
    Buffer.Width = Picture1(0).Width
    Buffer.Height = Picture1(0).Height
End Sub

Private Function DrawKeybd()

    Dim i As Long, x As Long, y As Long

    Buffer.Cls
    BitBlt Buffer.hDC, 0, 0, Picture1(0).Width, Picture1(0).Height, Picture1(1).hDC, 0, 0, SRCCOPY

    For i = 21 To 110

        If Sel(i) Then
            GetPos i, x, y
            BitBlt Buffer.hDC, x, 0, KW(y).Width, KW(y).Height, KW(y).hDC, 0, 0, SRCINVERT
        End If

    Next

    BitBlt Picture1(0).hDC, 0, 0, Picture1(0).Width, Picture1(0).Height, Buffer.hDC, 0, 0, SRCCOPY
    Picture1(0).Refresh
End Function
   
Public Function GetNote(ByVal x As Long, _
                        ByVal y As Long, _
                        Optional ByRef isHei As Boolean = False) As Byte

    Dim TH As Long, TW As Long, TX As Long, TS As Long, S1 As Long, S2 As Long, No As Long

    Dim Uw As Long

    Uw = Int(Round(Picture1(0).Width / 51))
    isHei = False
    TH = Picture1(0).Height
    TW = Picture1(0).Width
    TX = x \ Uw
    TS = x Mod Uw
    S1 = TX \ 7
    S2 = TX Mod 7
    No = S1 * 12 + 21

    If y < TH / 6 * 4 Then
        If TS > Uw * 2 / 3 And S2 + 3 <> 7 And S2 + 6 <> 7 Then No = No + 1
        If TS < Uw / 3 And S2 + 2 <> 7 And S2 + 5 <> 7 Then No = No - 1
    End If

    No = No + S2 * 2

    If S2 > 1 Then No = No - 1
    If S2 > 4 Then No = No - 1
    GetNote = No
End Function

Public Function GetPos(ByVal Note As Byte, ByRef x As Long, ByRef y As Long) As Boolean

    Dim x1 As Long, x2 As Long, X3 As Long

    Dim Uw As Long

    Uw = Int(Round(Picture1(0).Width / 51))

    x1 = (Note - 21) \ 12
    x2 = (Note - 21) Mod 12
    X3 = x2

    If x2 > 2 Then X3 = X3 + 1
    If x2 > 7 Then X3 = X3 + 1
   
    x = (x1 * 7 + X3 \ 2) * Uw
    y = X3 \ 2

    If (X3 + 1) Mod 2 = 0 Then y = 7
    If Note = 21 Then y = 2
    If Note = 108 Then y = 8
    If y = 7 Then x = x + Uw / 3 * 2

End Function

Public Property Get AutoPlay() As Boolean
    AutoPlay = AP
End Property

Public Property Let AutoPlay(ByVal vNewValue As Boolean)
    AP = vNewValue
End Property

Public Property Get mYinSe() As MidiMu
    mYinSe = YinSe
End Property

Public Property Let mYinSe(ByVal vNewValue As MidiMu)
    YinSe = vNewValue
End Property

Private Sub UserControl_WriteProperties(PropBag As PropertyBag)
    Call PropBag.WriteProperty("AutoPlay", AP)
    Call PropBag.WriteProperty("mYinSe", YinSe)
End Sub

Public Function GetMidiMu(ByVal Ys As MidiMu) As String

    Select Case Ys

        Case 0
            GetMidiMu = "0 Acoustic Grand Piano   ´ó¸ÖÇÙ£¨ÉùÑ§¸ÖÇÙ£© "

        Case 1
            GetMidiMu = "1 Bright Acoustic Piano         Ã÷ÁÁµÄ¸ÖÇÙ "

        Case 2
            GetMidiMu = "2 Electric Grand Piano              µç¸ÖÇÙ "

        Case 3
            GetMidiMu = "3 Honky-tonk Piano                ¾Æ°É¸ÖÇÙ "

        Case 4
            GetMidiMu = "4 Rhodes Piano                ÈáºÍµÄµç¸ÖÇÙ "

        Case 5
            GetMidiMu = "5 Chorused Piano        ¼ÓºÏ³ªÐ§¹ûµÄµç¸ÖÇÙ "

        Case 6
            GetMidiMu = "6 Harpsichord        Óð¹Ü¼üÇÙ£¨²¦ÏÒ¹Å¸ÖÇÙ£© "

        Case 7
            GetMidiMu = "7 Clavichord     ¿ÆÀ­Î¬¿ÆÌØÇÙ£¨»÷ÏÒ¹Å¸ÖÇÙ£© "

        Case 8
            GetMidiMu = "8 Celesta                           ¸ÖÆ¬ÇÙ "

        Case 9
            GetMidiMu = "9 Glockenspiel                        ÖÓÇÙ "

        Case 10
            GetMidiMu = "10 Music box                        °ËÒôºÐ "

        Case 11
            GetMidiMu = "11 Vibraphone                       ²üÒôÇÙ "

        Case 12
            GetMidiMu = "12 Marimba                          ÂíÁÖ°Í "

        Case 13
            GetMidiMu = "13 Xylophone                          Ä¾ÇÙ "

        Case 14
            GetMidiMu = "14 Tubular Bells                      ¹ÜÖÓ "

        Case 15
            GetMidiMu = "15 Dulcimer                         ´óÑïÇÙ "

        Case 16
            GetMidiMu = "16 Hammond Organ                  »÷¸Ë·çÇÙ "

        Case 17
            GetMidiMu = "17 Percussive Organ             ´ò»÷Ê½·çÇÙ "

        Case 18
            GetMidiMu = "18 Rock Organ                     Ò¡¹ö·çÇÙ "

        Case 19
            GetMidiMu = "19 Church Organ                   ½ÌÌÃ·çÇÙ "

        Case 20
            GetMidiMu = "20 Reed Organ                     »É¹Ü·çÇÙ "

        Case 21
            GetMidiMu = "21 Accordian                        ÊÖ·çÇÙ "

        Case 22
            GetMidiMu = "22 Harmonica                          ¿ÚÇÙ "

        Case 23
            GetMidiMu = "23 Tango Accordian              Ì½¸êÊÖ·çÇÙ "

        Case 24
            GetMidiMu = "24 Acoustic Guitar (nylon)      ÄáÁúÏÒ¼ªËû "

        Case 25
            GetMidiMu = "25 Acoustic Guitar (steel)        ¸ÖÏÒ¼ªËû "

        Case 26
            GetMidiMu = "26 Electric Guitar (jazz)       ¾ôÊ¿µç¼ªËû "

        Case 27
            GetMidiMu = "27 Electric Guitar (clean)      ÇåÒôµç¼ªËû "

        Case 28
            GetMidiMu = "28 Electric Guitar (muted)      ÃÆÒôµç¼ªËû "

        Case 29
            GetMidiMu = "29 Overdriven Guitar    ¼ÓÇý¶¯Ð§¹ûµÄµç¼ªËû "

        Case 30
            GetMidiMu = "30 Distortion Guitar    ¼ÓÊ§ÕæÐ§¹ûµÄµç¼ªËû "

        Case 31
            GetMidiMu = "31 Guitar Harmonics               ¼ªËûºÍÒô "

        Case 32
            GetMidiMu = "32 Acoustic Bass         ´ó±´Ë¾£¨ÉùÑ§±´Ë¾£© "

        Case 33
            GetMidiMu = "33 Electric Bass(finger)     µç±´Ë¾£¨Ö¸µ¯£© "

        Case 34
            GetMidiMu = "34 Electric Bass (pick)      µç±´Ë¾£¨²¦Æ¬£© "

        Case 35
            GetMidiMu = "35 Fretless Bass                  ÎÞÆ·±´Ë¾ "

        Case 36
            GetMidiMu = "36 Slap Bass 1                   ÕÆ»÷Bass 1 "

        Case 37
            GetMidiMu = "37 Slap Bass 2                  ÕÆ»÷Bass 2 "

        Case 38
            GetMidiMu = "38 Synth Bass 1             µç×ÓºÏ³ÉBass 1 "

        Case 39
            GetMidiMu = "39 Synth Bass 2             µç×ÓºÏ³ÉBass 2 "

        Case 40
            GetMidiMu = "40 Violin                           Ð¡ÌáÇÙ "

        Case 41
            GetMidiMu = "41 Viola                            ÖÐÌáÇÙ "

        Case 42
            GetMidiMu = "42 Cello                            ´óÌáÇÙ "

        Case 43
            GetMidiMu = "43 Contrabass                   µÍÒô´óÌáÇÙ "

        Case 44
            GetMidiMu = "44 Tremolo Strings          ÏÒÀÖÈº²üÒôÒôÉ« "

        Case 45
            GetMidiMu = "45 Pizzicato Strings        ÏÒÀÖÈº²¦ÏÒÒôÉ« "

        Case 46
            GetMidiMu = "46 Orchestral Harp                    ÊúÇÙ "

        Case 47
            GetMidiMu = "47 Timpani                          ¶¨Òô¹Ä "

        Case 48
            GetMidiMu = "48 String Ensemble 1         ÏÒÀÖºÏ×àÒôÉ«1 "

        Case 49
            GetMidiMu = "49 String Ensemble 2         ÏÒÀÖºÏ×àÒôÉ«2 "

        Case 50
            GetMidiMu = "50 Synth Strings 1       ºÏ³ÉÏÒÀÖºÏ×àÒôÉ«1 "

        Case 51
            GetMidiMu = "51 Synth Strings 2       ºÏ³ÉÏÒÀÖºÏ×àÒôÉ«2 "

        Case 52
            GetMidiMu = "52 Choir Aahs               ÈËÉùºÏ³ª¡°°¡¡± "

        Case 53
            GetMidiMu = "53 Voice Oohs                   ÈËÉù¡°à½¡± "

        Case 54
            GetMidiMu = "54 Synth Voice                    ºÏ³ÉÈËÉù "

        Case 55
            GetMidiMu = "55 Orchestra Hit            ¹ÜÏÒÀÖÇÃ»÷Æë×à "

        Case 56
            GetMidiMu = "56 Trumpet                            Ð¡ºÅ "

        Case 57
            GetMidiMu = "57 Trombone                           ³¤ºÅ "

        Case 58
            GetMidiMu = "58 Tuba                               ´óºÅ "

        Case 59
            GetMidiMu = "59 Muted Trumpet              ¼ÓÈõÒôÆ÷Ð¡ºÅ "

        Case 60
            GetMidiMu = "60 French Horn               ·¨¹úºÅ£¨Ô²ºÅ£© "

        Case 61
            GetMidiMu = "61 Brass Section Í­¹Ü×é£¨Í­¹ÜÀÖÆ÷ºÏ×àÒôÉ«£© "

        Case 62
            GetMidiMu = "62 Synth Brass 1             ºÏ³ÉÍ­¹ÜÒôÉ«1 "

        Case 63
            GetMidiMu = "63 Synth Brass 2             ºÏ³ÉÍ­¹ÜÒôÉ«2 "

        Case 64
            GetMidiMu = "64 Soprano Sax                ¸ßÒôÈø¿ËË¹·ç "

        Case 65
            GetMidiMu = "65 Alto Sax                 ´ÎÖÐÒôÈø¿ËË¹·ç "

        Case 66
            GetMidiMu = "66 Tenor Sax                  ÖÐÒôÈø¿ËË¹·ç "

        Case 67
            GetMidiMu = "67 Baritone Sax               µÍÒôÈø¿ËË¹·ç "

        Case 68
            GetMidiMu = "68 Oboe                             Ë«»É¹Ü "

        Case 69
            GetMidiMu = "69 English Horn                     Ó¢¹ú¹Ü "

        Case 70
            GetMidiMu = "70 Bassoon                     °ÍËÉ£¨´ó¹Ü£© "

        Case 71
            GetMidiMu = "71 Clarinet                  µ¥»É¹Ü£¨ºÚ¹Ü£© "

        Case 72
            GetMidiMu = "72 Piccolo                            ¶ÌµÑ "

        Case 73
            GetMidiMu = "73 Flute                               ³¤µÑ "

        Case 74
            GetMidiMu = "74 Recorder                           ÊúµÑ "

        Case 75
            GetMidiMu = "75 Pan Flute                          ÅÅóï "

        Case 76
            GetMidiMu = "76 Bottle Blow               [ÖÐÎÄÃû³ÆÔÝÈ±]"

        Case 77
            GetMidiMu = "77 Shakuhachi                     ÈÕ±¾³ß°Ë "

        Case 78
            GetMidiMu = "78 Whistle                          ¿ÚÉÚÉù "

        Case 79
            GetMidiMu = "79 Ocarina                         °Â¿¨À×ÄÇ "

        Case 80
            GetMidiMu = "80 Lead 1 (square)        ºÏ³ÉÖ÷Òô1£¨·½²¨£© "

        Case 81
            GetMidiMu = "81 Lead 2 (sawtooth)    ºÏ³ÉÖ÷Òô2£¨¾â³Ý²¨£© "

        Case 82
            GetMidiMu = "82 Lead 3 (caliope lead)         ºÏ³ÉÖ÷Òô3 "

        Case 83
            GetMidiMu = "83 Lead 4 (chiff lead)           ºÏ³ÉÖ÷Òô4 "

        Case 84
            GetMidiMu = "84 Lead 5 (charang)              ºÏ³ÉÖ÷Òô5 "

        Case 85
            GetMidiMu = "85 Lead 6 (voice)         ºÏ³ÉÖ÷Òô6£¨ÈËÉù£© "

        Case 86
            GetMidiMu = "86 Lead 7 (fifths)    ºÏ³ÉÖ÷Òô7£¨Æ½ÐÐÎå¶È£© "

        Case 87
            GetMidiMu = "87 Lead 8 (bass+lead)ºÏ³ÉÖ÷Òô8£¨±´Ë¾¼ÓÖ÷Òô£© "

        Case 88
            GetMidiMu = "88 Pad 1 (new age)      ºÏ³ÉÒôÉ«1£¨ÐÂÊÀ¼Í£© "

        Case 89
            GetMidiMu = "89 Pad 2 (warm)          ºÏ³ÉÒôÉ«2 £¨ÎÂÅ¯£© "

        Case 90
            GetMidiMu = "90 Pad 3 (polysynth)              ºÏ³ÉÒôÉ«3 "

        Case 91
            GetMidiMu = "91 Pad 4 (choir)         ºÏ³ÉÒôÉ«4 £¨ºÏ³ª£© "

        Case 92
            GetMidiMu = "92 Pad 5 (bowed)                 ºÏ³ÉÒôÉ«5 "

        Case 93
            GetMidiMu = "93 Pad 6 (metallic)    ºÏ³ÉÒôÉ«6 £¨½ðÊôÉù£© "

        Case 94
            GetMidiMu = "94 Pad 7 (halo)          ºÏ³ÉÒôÉ«7 £¨¹â»·£© "

        Case 95
            GetMidiMu = "95 Pad 8 (sweep)                 ºÏ³ÉÒôÉ«8 "

        Case 96
            GetMidiMu = "96 FX 1 (rain)             ºÏ³ÉÐ§¹û 1 ÓêÉù "

        Case 97
            GetMidiMu = "97 FX 2 (soundtrack)       ºÏ³ÉÐ§¹û 2 Òô¹ì "

        Case 98
            GetMidiMu = "98 FX 3 (crystal)          ºÏ³ÉÐ§¹û 3 Ë®¾§ "

        Case 99
            GetMidiMu = "99 FX 4 (atmosphere)       ºÏ³ÉÐ§¹û 4 ´óÆø "

        Case 100
            GetMidiMu = "100 FX 5 (brightness)      ºÏ³ÉÐ§¹û 5 Ã÷ÁÁ "

        Case 101
            GetMidiMu = "101 FX 6 (goblins)         ºÏ³ÉÐ§¹û 6 ¹í¹Ö "

        Case 102
            GetMidiMu = "102 FX 7 (echoes)          ºÏ³ÉÐ§¹û 7 »ØÉù "

        Case 103
            GetMidiMu = "103 FX 8 (sci-fi)          ºÏ³ÉÐ§¹û 8 ¿Æ»Ã "

        Case 104
            GetMidiMu = "104 Sitar                    Î÷Ëþ¶û£¨Ó¡¶È£© "

        Case 105
            GetMidiMu = "105 Banjo                    °à×¿ÇÙ£¨ÃÀÖÞ£© "

        Case 106
            GetMidiMu = "106 Shamisen                 ÈýÃÁÏß£¨ÈÕ±¾£© "

        Case 107
            GetMidiMu = "107 Koto                   Ê®ÈýÏÒóÝ£¨ÈÕ±¾£© "

        Case 108
            GetMidiMu = "108 Kalimba                         ¿¨ÁÖ°Í "

        Case 109
            GetMidiMu = "109 Bagpipe                           ·çµÑ "

        Case 110
            GetMidiMu = "110 Fiddle                        Ãñ×åÌáÇÙ "

        Case 111
            GetMidiMu = "111 Shanai                            É½ÄÎ "

        Case 112
            GetMidiMu = "112 Tinkle Bell                     ¶£µ±Áå "

        Case 113
            GetMidiMu = "113 Agogo                    [ÖÐÎÄÃû³ÆÔÝÈ±]"

        Case 114
            GetMidiMu = "114 Steel Drums                       ¸Ö¹Ä "

        Case 115
            GetMidiMu = "115 Woodblock                         Ä¾Óã "

        Case 116
            GetMidiMu = "116 Taiko Drum                        Ì«¹Ä "

        Case 117
            GetMidiMu = "117 Melodic Tom                     Í¨Í¨¹Ä "

        Case 118
            GetMidiMu = "118 Synth Drum                      ºÏ³É¹Ä "

        Case 119
            GetMidiMu = "119 Reverse Cymbal                    Í­îà "

        Case 120
            GetMidiMu = "120 Guitar Fret Noise         ¼ªËû»»°ÑÔÓÒô "

        Case 121
            GetMidiMu = "121 Breath Noise                    ºôÎüÉù "

        Case 122
            GetMidiMu = "122 Seashore                        º£ÀËÉù "

        Case 123
            GetMidiMu = "123 Bird Tweet                        ÄñÃù "

        Case 124
            GetMidiMu = "124 Telephone Ring                  µç»°Áå "

        Case 125
            GetMidiMu = "125 Helicopter                      Ö±Éý»ú "

        Case 126
            GetMidiMu = "126 Applause                        ¹ÄÕÆÉù "

        Case 127
            GetMidiMu = "127 Gunshot                           Ç¹Éù"
    End Select

End Function
'Download by http://www.codefans.net
